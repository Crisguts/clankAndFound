# Lost & Found - Product Requirements & API Contract (ConUHacks 2026)

## 1. Overview
A privacy-first Lost & Found application.
- **Users**: Submit reports ("Inquiries") of lost items. They **cannot** search the inventory.
- **Assistants (Admins)**: Manage the "Found Items" inventory. They review "Matches" generated by the system.

## 2. Authentication & Roles
We use **Supabase Auth**.
- **Role: 'user'**: Default role. Can only submit inquiries and view their own status.
- **Role: 'assistant'**: Admin role. Can view `inventory` and `matches`.
    - *How to set:* Sign up, then manually update `profiles.role` to `'assistant'` in Supabase Table.

## 3. Data Flow
1.  **User Inquiry**: User fills form (Text or Image) -> stored in `inquiries`.
2.  **Auto-Tagging**: Backend uses Gemini to generate `description` and keywords from image.
3.  **Match Generation**: Backend searches `inventory` (Text Search) for close matches.
4.  **Review Queue**: Assistant opens Dashboard -> sees "Pending Matches".
5.  **Resolution**: Assistant clicks "Confirm" -> User gets email "Found!".

## 4. API Endpoints (Backend Contract)

### A. Public / User Endpoints

#### `POST /api/inquiry`
*   **Purpose**: Submit a new lost item.
*   **Body**:
    ```json
    {
      "description": "Black iPhone 13",
      "image": "base64_string_or_form_data" (optional),
      "user_id": "uuid_from_supabase_auth"
    }
    ```
*   **Response**: `{ success: true, inquiry_id: "..." }`

### B. Assistant / Admin Endpoints (Protected)

#### `POST /api/inventory`
*   **Purpose**: Log a found item into the hidden catalog.
*   **Body**:
    ```json
    {
      "description": "Found a red scarf",
      "location": "H-Building Lobby",
      "image": "..."
    }
    ```

#### `GET /api/assistant/matches`
*   **Purpose**: Get the queue of potential matches to review.
*   **Response**:
    ```json
    [
      {
        "match_id": "...",
        "score": 0.85,
        "inquiry": { "description": "Lost red scarf", "image": "..." },
        "inventory": { "description": "Found red scarf", "image": "..." }
      }
    ]
    ```

#### `POST /api/assistant/matches/:id/confirm`
*   **Purpose**: Confirm a match. Triggers email to user.

## 5. Frontend Requirements (What to build)

### User Flow
1.  **Landing Page**: "I Lost Something" vs "Staff Login".
2.  **Inquiry Form**: Text input + File Upload.
3.  **My Dashboard**: List of my inquiries using Supabase Client:
    *   `supabase.from('inquiries').select('*').eq('user_id', user.id)`

### Assistant Flow (Dashboard)
1.  **Inventory Tab**: Simple form to add found items.
2.  **Matches Tab**:
    *   Cards showing "User's Inquiry" (left) vs "Found Item" (right).
    *   "Approve Match" / "Reject" buttons.

## 6. Database Schema (Supabase)
*   `profiles`: `{ id, role }`
*   `inventory`: `{ id, description, search_tsv, location, image_url }` (Hidden from users)
*   `inquiries`: `{ id, user_id, description, image_url, status }`
*   `matches`: `{ id, inquiry_id, inventory_id, status, score }`
